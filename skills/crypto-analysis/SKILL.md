---
name: crypto-analysis
description: This skill should be used when the user asks to "analyze crypto", "分析行情", "analyze btc", "look at eth", "check sol", or mentions cryptocurrency technical analysis. It provides market maker perspective analysis using Binance API data.
version: 1.3.0
---

# Crypto Analysis Skill

做市商视角的加密货币技术分析框架。

## 核心原则

| # | 原则 |
|---|------|
| 1 | **做市商视角** — 站在流动性提供者/庄家角度思考 |
| 2 | **结构推演** — 禁止直接给"看涨/看跌"结论，必须通过结构推演 |
| 3 | **多路径思维** — 必须输出 3 条以上可能路径 |
| 4 | **可证伪性** — 所有判断必须附带否定条件 |
| 5 | **概率量化** — 路径概率必须给具体数值（如 55%） |

## 数据获取

每次分析必须调用币安 API 获取实时数据。参考 `references/api-endpoints.md` 获取完整端点列表。

### 必需数据

1. **K 线数据**：获取指定周期的 OHLCV 数据
2. **资金费率**：判断市场情绪极端值
3. **持仓量（OI）**：多空力量对比
4. **多空比**：大户和散户持仓比例

### API 调用示例

```bash
# K 线数据（合约）
curl -s "https://fapi.binance.com/fapi/v1/klines?symbol=BTCUSDT&interval=1h&limit=100"

# 资金费率
curl -s "https://fapi.binance.com/fapi/v1/fundingRate?symbol=BTCUSDT&limit=1"

# 持仓量
curl -s "https://fapi.binance.com/fapi/v1/openInterest?symbol=BTCUSDT"

# 大户多空比
curl -s "https://fapi.binance.com/futures/data/topLongShortAccountRatio?symbol=BTCUSDT&period=1h&limit=1"
```

### API 调用规范

为避免触发币安 API 限流（HTTP 418），必须遵守以下规则：

1. **请求间隔**：每次 API 请求间隔至少 100ms
2. **批量获取**：优先使用 `limit` 参数一次获取足够数据，避免多次请求
3. **重试机制**：遇到错误时使用指数退避重试
   - 第1次重试：等待 1s
   - 第2次重试：等待 2s
   - 第3次重试：等待 4s
   - 最多重试 3 次
4. **错误处理**：
   - HTTP 418/429：暂停请求 30s 后重试
   - JSON 解析错误：检查响应内容，可能是 HTML 错误页面
   - 超时：使用缓存数据继续分析

```bash
# 推荐：一次获取多个周期（减少请求次数）
# 获取 4H K 线时，limit=200 可覆盖约 33 天数据
curl -s "https://fapi.binance.com/fapi/v1/klines?symbol=BTCUSDT&interval=4h&limit=200"
```

## 指标计算

获取 K 线数据后，计算以下指标。详细公式参考 `references/indicators.md`。

### 核心指标（必算）
- **RSI (14)**：超买超卖判断
- **MACD (12, 26, 9)**：趋势动量
- **ATR (14)**：波动率
- **布林带 (20, 2)**：波动区间和百分位
- **EMA (20, 50, 200)**：趋势方向

### 可选指标
- **斐波那契回撤**：回调/反弹关键位（需明确波段起点时使用）

## 输出框架

### 数据面板

```
┌─────────────────────────────────────────────────────────────┐
│ 📊 {SYMBOL}/USDT 永续合约 │ {INTERVAL} │ {TIME}            │
├─────────────────────────────────────────────────────────────┤
│ 价格: ${PRICE}  │ 24h: {CHANGE}%  │ 成交量: ${VOL}         │
├─────────────────────────────────────────────────────────────┤
│ 【持仓数据】                                                 │
│ OI: {OI} │ 资金费率: {RATE}% │ 多空比(大户): {RATIO}       │
├─────────────────────────────────────────────────────────────┤
│ 【技术指标】                                                 │
│ RSI(14): {RSI} │ MACD: {DIF}/{DEA} │ ATR(14): ${ATR}       │
│ 布林: ${BOLL_UP} / ${BOLL_MID} / ${BOLL_DN} │ 带宽: {BW}%  │
│ EMA: 20=${EMA20} │ 50=${EMA50} │ 200=${EMA200}             │
└─────────────────────────────────────────────────────────────┘
```

### 执行摘要

```
┌─────────────────────────────────────────────────────────────┐
│ 🎯 执行摘要                                                  │
├─────────────────────────────────────────────────────────────┤
│ 核心区间: $_____ – $_____                                   │
│ 做市阶段: □吸筹 □拉升 □派发 □再平衡 □诱导                    │
│ 庄家意图: _____________________________________             │
│ 陷阱对象: □追多者 □扛空者 □抄底者 □高杠杆                    │
│ 一句话: _______________________________________             │
└─────────────────────────────────────────────────────────────┘
```

完整输出模板参考 `references/analysis-template.md`。

## 分析流程

### 单周期分析

1. 获取 K 线和衍生品数据
2. 计算技术指标
3. 输出数据面板和执行摘要
4. 分析流动性分布和资金流向
5. 判断做市阶段
6. 输出多路径推演（3 条以上）
7. 给出操作建议和关键监控点

### 全周期分析

支持两种模式：

#### 短线模式（默认，interval=full）

适合持仓 1-3 天的短线交易。

周期配置：`1d → 4h → 1h → 15m`（间隔 6x/4x/4x）

```
┌────────┬────────┬────────┬─────────────┬───────────────┬──────────┐
│ 周期   │ 趋势   │ RSI    │ MACD        │ 关键位        │ 信号强度  │
├────────┼────────┼────────┼─────────────┼───────────────┼──────────┤
│ 日线   │ ↑/↓/— │ ___    │ ___         │ $_____        │ ★★★☆☆   │
│ 4H     │ ↑/↓/— │ ___    │ ___         │ $_____        │ ★★★☆☆   │
│ 1H     │ ↑/↓/— │ ___    │ ___         │ $_____        │ ★★★☆☆   │
│ 15m    │ ↑/↓/— │ ___    │ ___         │ $_____        │ ★★★☆☆   │
└────────┴────────┴────────┴─────────────┴───────────────┴──────────┘
```

#### 波段模式（interval=swing）

适合持仓 3-14 天的波段交易。

周期配置：`1w → 1d → 4h → 1h`（间隔 7x/6x/4x）

```
┌────────┬────────┬────────┬─────────────┬───────────────┬──────────┐
│ 周期   │ 趋势   │ RSI    │ MACD        │ 关键位        │ 信号强度  │
├────────┼────────┼────────┼─────────────┼───────────────┼──────────┤
│ 周线   │ ↑/↓/— │ ___    │ ___         │ $_____        │ ★★★☆☆   │
│ 日线   │ ↑/↓/— │ ___    │ ___         │ $_____        │ ★★★☆☆   │
│ 4H     │ ↑/↓/— │ ___    │ ___         │ $_____        │ ★★★☆☆   │
│ 1H     │ ↑/↓/— │ ___    │ ___         │ $_____        │ ★★★☆☆   │
└────────┴────────┴────────┴─────────────┴───────────────┴──────────┘
```

**触发方式**：
- 用户说「全周期分析」「full」→ 短线模式
- 用户说「波段分析」「swing」→ 波段模式

### 快速分析（quick）

适合快速查看当前状态，不需要完整分析。

**触发方式**：用户说「快速分析」「quick」「btc quick」

**周期配置**：仅 4h + 1h

```
┌─────────────────────────────────────────────────────────────┐
│ ⚡ {SYMBOL} 快速分析 │ {TIME}                                │
├─────────────────────────────────────────────────────────────┤
│ 价格: ${PRICE} │ 4H RSI: ___ │ 1H MACD: ___               │
│ 资金费率: ___％ │ 多空比: ___ │ OI: ___                    │
├─────────────────────────────────────────────────────────────┤
│ 一句话: _____________________________________               │
│ 关键位: 支撑 $_____ │ 阻力 $_____                          │
└─────────────────────────────────────────────────────────────┘
```

### 持仓分析（position）

带入场价的持仓分析，自动计算盈亏并给出针对性建议。

**触发方式**：
- 用户说「btc position 87600」
- 用户说「btc 持仓 87600」
- 用户说「我 87600 做多了 btc」

**输出模板**：

```
┌─────────────────────────────────────────────────────────────┐
│ 📍 {SYMBOL} 持仓分析                                         │
├─────────────────────────────────────────────────────────────┤
│ 入场价: ${ENTRY} │ 当前价: ${PRICE}                         │
│ 浮盈/亏: {+/-}___％ (${DIFF})                               │
├─────────────────────────────────────────────────────────────┤
│ 市场环境:                                                    │
│ • 趋势: _____ │ 动量: _____ │ 波动: _____                  │
│ • 资金面: 费率 ___％ │ 多空比 ___                           │
├─────────────────────────────────────────────────────────────┤
│ 💡 建议:                                                     │
│ [明确的单一建议]                                             │
│                                                              │
│ 执行计划:                                                    │
│ • _____ @ $_____                                            │
│ • _____ @ $_____                                            │
├─────────────────────────────────────────────────────────────┤
│ ⚠️ 风险: _____________________________________              │
└─────────────────────────────────────────────────────────────┘
```

### 复盘分析（replay）

回顾近期走势，对比之前的判断。

**触发方式**：用户说「复盘」「replay」「btc 复盘」

**功能**：
1. 获取最近 24h/7d 的价格走势
2. 标注关键转折点
3. 分析做市商行为
4. 提炼可迁移经验

## 连续对话支持

### 再分析

当用户说「再分析」时：
1. 重新获取最新数据
2. 对照之前路径的否定条件
3. 更新路径状态（✅ 有效 / ❌ 否定）
4. 调整概率分配

### 复盘

当用户说「复盘」时：
1. 回顾初始判断与实际走势
2. 标注哪些路径被验证/否定
3. 分析关键转折点
4. 提炼可迁移经验

## 常见做市剧本

### 日内双杀

最常见的日内操控模式，一天内先后清洗多空双方。

```
价格走势示意：
        ∧ (诱多高点)
       / \
      /   \___________/  (V 型反转)
─────●                 ●
   开盘    杀多    杀空   收盘
```

**阶段分解**:
1. **第一幕（诱多）**: 突破关键阻力，吸引追多盘入场
2. **第二幕（杀多）**: 快速下砸 3-5%，触发多头止损 + 杠杆清算
3. **第三幕（杀空）**: 底部 V 型反弹，逼迫空头回补

**识别特征**:
- 日内振幅 > 5%
- 资金费率快速下降（从正常降至 < 0.005%）
- 4H RSI 触及超卖区后反弹

### 假突破（诱多陷阱）

```
阻力位 ─────────────────────
              ∧ (假突破)
             / \
────────────/   \
                 ↓ 快速回落
```

**特征**:
- 首次突破关键阻力后无法站稳
- 突破后 15 分钟内回落至阻力位下方
- 成交量在突破时放大但后续萎缩

**应对**: 不追第一根突破 K 线，等待回踩确认

### 假跌破（诱空陷阱）

```
                 ↑ 快速收回
支撑位 ────────────\   /─────────
                    ∨ (假跌破)
```

**特征**:
- 跌破支撑后快速收回（15-30 分钟内）
- 跌破时费率不升反降（说明空头并未大举入场）
- RSI 处于超卖区（< 30）

**应对**: RSI < 30 时不追空，等待确认信号

### 洗盘-拉升

```
          ┌─────────────┐ (新高)
          │             │
     ∧    │   拉升      │
    / \   │             │
───●   \__│             │
  前高  洗盘│             │
```

**特征**:
- 在前高附近横盘整理
- 突然快速下跌清洗获利盘
- 随后强势拉升突破前高

**识别**: OI 在洗盘时下降，拉升时上升

## 跨品种分析

### ETH 作为情绪放大器

ETH 波动率通常高于 BTC，是市场情绪的放大镜。

| 信号 | 含义 |
|------|------|
| ETH 跌幅 > BTC × 1.5 | 恐慌加剧，山寨承压 |
| ETH 涨幅 > BTC × 1.5 | 风险偏好回归 |
| ETH 费率 < BTC 费率 | 山寨恐慌更深 |
| ETH 滞涨（BTC 涨 ETH 不涨）| 警惕假突破 |

### 联动分析应用

- **场景1**: BTC 4H RSI < 30 + ETH 费率 < 0.005% → 反弹概率大增
- **场景2**: BTC 突破阻力 + ETH 滞涨 → 警惕假突破
- **场景3**: ETH/BTC 汇率企稳 + ETH 费率回升 → 山寨季信号

## 斐波那契回撤（可选工具）

在明确的趋势波段中使用，辅助判断回调/反弹关键位。

### 使用场景

| 场景 | 画法 |
|------|------|
| 上涨后回调 | 从波段**低点**画到**高点** |
| 下跌后反弹 | 从波段**高点**画到**低点** |

### 关键回撤位

| 回撤比例 | 含义 | 操作提示 |
|---------|------|---------|
| 23.6% | 强势回调 | 趋势延续信号，可顺势加仓 |
| 38.2% | 健康回调 | 常见首次支撑位 |
| 50.0% | 标准回调 | 多空分界，站稳则趋势延续 |
| 61.8% | 深度回调 | 黄金分割位，趋势可能转弱 |
| 78.6% | 最后防线 | 跌破则趋势大概率反转 |

### 使用原则

> **重要**: 斐波那契单独使用意义有限，必须与其他信号共振才有效：
> - 斐波那契位 + EMA 支撑/阻力 = 强共振
> - 斐波那契位 + 前高/前低 = 强共振
> - 斐波那契位 + 成交密集区 = 强共振

### 示例

```
BTC 从 $85,000 涨到 $97,000 后回调：
波段幅度: $97,000 - $85,000 = $12,000

23.6% 回撤: $97,000 - $12,000 × 0.236 = $94,168
38.2% 回撤: $97,000 - $12,000 × 0.382 = $92,416
50.0% 回撤: $97,000 - $12,000 × 0.500 = $91,000
61.8% 回撤: $97,000 - $12,000 × 0.618 = $89,584
78.6% 回撤: $97,000 - $12,000 × 0.786 = $87,568
```

## 持仓状态感知

分析时必须询问或推断用户持仓状态，根据不同状态给出针对性建议。

### 状态识别

| 状态 | 识别方式 | 建议重点 |
|------|---------|---------|
| **无仓位** | 用户未提及持仓 | 入场点位、建仓策略 |
| **持有多单** | 用户说「我有多单」「做多了」「入场价 xxx」 | 止盈/止损调整、是否加仓/减仓 |
| **持有空单** | 用户说「我有空单」「做空了」 | 止盈/止损调整、是否加仓/减仓 |
| **已平仓** | 用户说「已出」「平仓了」「空仓」 | 是否可以重新入场 |

### 场景化建议模板

#### 场景 A：无仓位

```
┌─────────────────────────────────────────────────────────────┐
│ 💡 操作建议（无仓位）                                        │
├─────────────────────────────────────────────────────────────┤
│ 当前适合: □观望 □做多 □做空                                 │
│                                                              │
│ 若做多:                                                      │
│ • 入场区: $_____                                             │
│ • 止损: $_____（亏损 ___％）                                 │
│ • 目标: $_____ → $_____                                     │
│ • 仓位: 总资金 ___％                                         │
│                                                              │
│ 不建议: _____________________________________               │
└─────────────────────────────────────────────────────────────┘
```

#### 场景 B：持有仓位

```
┌─────────────────────────────────────────────────────────────┐
│ 💡 持仓建议（{多/空}单 @ ${入场价}）                         │
├─────────────────────────────────────────────────────────────┤
│ 当前盈亏: {+/-}___％ (${当前价} vs ${入场价})                │
│ 市场状态: _____________________________________              │
│                                                              │
│ 建议操作:                                                    │
│ □ 继续持有 — 理由: _____                                    │
│ □ 部分止盈 — 在 $_____ 减仓 ___％                           │
│ □ 全部止盈 — 在 $_____ 离场                                 │
│ □ 止损调整 — 移至 $_____                                    │
│ □ 加仓 — 在 $_____ 加仓 ___％                               │
│                                                              │
│ ⚠️ 风险提示: _____________________________________          │
└─────────────────────────────────────────────────────────────┘
```

**避免矛盾建议**：
- ❌ 不要同时建议「止盈」和「加仓」
- ❌ 不要给出多个互斥的操作
- ✅ 只给出一个明确的主建议 + 备选条件

## 底部/顶部信号追踪

使用简洁的表格格式追踪关键信号：

### 底部信号检查表

```
┌─────────────────────────────────────────────────────────────┐
│ 📋 底部信号追踪                                              │
├─────────────────────────────────────────────────────────────┤
│ ✅ 多空比 < 2.5          当前: ___ (目标: < 2.5)            │
│ ✅ 4H RSI > 35           当前: ___ (需从超卖区回升)         │
│ ❌ 日线收阳              当前: ___ (需 > ___％)             │
│ ❌ 1H MACD 金叉          当前: ___ (需 DIF > DEA)           │
│ ✅ 资金费率负            当前: ___％ (目标: < 0.01％)       │
│ ❌ OI 下降后企稳         当前: ___ (较高点 -___％)          │
├─────────────────────────────────────────────────────────────┤
│ 达成: 3/6 → 信号强度: ★★★☆☆                                │
│ 建议: 等待更多信号确认后再入场                               │
└─────────────────────────────────────────────────────────────┘
```

### 顶部信号检查表

```
┌─────────────────────────────────────────────────────────────┐
│ 📋 顶部信号追踪                                              │
├─────────────────────────────────────────────────────────────┤
│ ❌ 多空比 > 3.5          当前: ___ (过热警戒)               │
│ ❌ 4H RSI > 70           当前: ___ (超买区)                 │
│ ❌ 资金费率 > 0.05％      当前: ___％                        │
│ ❌ OI 创新高             当前: ___ BTC                      │
│ ❌ 周线 RSI > 80         当前: ___ (牛市顶部区)             │
│ ❌ 价格触及周线上轨       当前: $_____                       │
├─────────────────────────────────────────────────────────────┤
│ 达成: 0/6 → 尚未出现顶部信号                                │
└─────────────────────────────────────────────────────────────┘
```

## 注意事项

- 所有价格必须精确到小数点后 2 位
- 概率总和必须等于 100%
- 禁止使用时事直接判断方向
- 否定条件必须具体可验证
- 关注资金费率极端值（< 0.005% 或 > 0.05%）
- 多空比 > 3.5 时警惕反转
- 斐波那契需与其他指标共振使用
- **持仓建议必须单一明确，避免矛盾**
